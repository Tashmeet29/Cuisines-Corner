<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favourites</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="container mt-4 wishlist-container">
        <div class="d-flex justify-content-between mb-4">
            <a class="btn btn-primary" href="menu.html">Back to Menu</a>
            <a class="btn btn-success" href="order.html">Order</a>
        </div>
        <h2>Favourites</h2>
        <table class="table table-bordered wishlist-table">
            <thead>
                <tr>
                    <th>Dish</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                    <th>Add to Order</th>
                </tr>
            </thead>
            <tbody id="wishlistTableBody">
                <!-- Wishlist items will be dynamically added here -->
            </tbody>
        </table>
        <p><strong>Total: <span id="wishlistTotal">&#8377;0</span></strong></p>
    </div>

    <script>
        // Load wishlist items from local storage or initialize with an empty array
        const wishlistItems = JSON.parse(localStorage.getItem('wishlistItems')) || [];
        const orderItems = JSON.parse(localStorage.getItem('orderItems')) || [];

        // Function to save wishlist items to local storage
        function saveWishlist() {
            localStorage.setItem('wishlistItems', JSON.stringify(wishlistItems));
        }

        // Function to save order items to local storage
        function saveOrderItems() {
            localStorage.setItem('orderItems', JSON.stringify(orderItems));
        }

        // Function to render wishlist items
        function renderWishlist() {
            const wishlistTableBody = document.getElementById('wishlistTableBody');
            wishlistTableBody.innerHTML = '';

            let totalAmount = 0;

            wishlistItems.forEach((item, index) => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                row.appendChild(nameCell);

                const priceCell = document.createElement('td');
                priceCell.textContent = `₹${item.price}`;
                row.appendChild(priceCell);

                const quantityCell = document.createElement('td');
                const quantityDiv = document.createElement('div');
                quantityDiv.classList.add('quantity-controls');

                const minusButton = document.createElement('button');
                minusButton.classList.add('btn', 'btn-danger');
                minusButton.textContent = '-';
                minusButton.onclick = () => updateQuantity(index, -1);
                quantityDiv.appendChild(minusButton);

                const quantityText = document.createElement('span');
                quantityText.textContent = item.quantity;
                quantityText.id = `quantity_${index}`;
                quantityDiv.appendChild(quantityText);

                const plusButton = document.createElement('button');
                plusButton.classList.add('btn', 'btn-success');
                plusButton.textContent = '+';
                plusButton.onclick = () => updateQuantity(index, 1);
                quantityDiv.appendChild(plusButton);

                quantityCell.appendChild(quantityDiv);
                row.appendChild(quantityCell);

                const actionCell = document.createElement('td');
                const removeButton = document.createElement('button');
                removeButton.classList.add('btn', 'btn-danger');
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeItem(index);
                actionCell.appendChild(removeButton);
                row.appendChild(actionCell);

                const addToOrderCell = document.createElement('td');
                const addToOrderButton = document.createElement('button');
                addToOrderButton.classList.add('btn', 'btn-warning');
                addToOrderButton.textContent = 'Add to Order';
                addToOrderButton.onclick = () => addToOrder(index);
                addToOrderCell.appendChild(addToOrderButton);
                row.appendChild(addToOrderCell);

                wishlistTableBody.appendChild(row);

                totalAmount += item.price * item.quantity;
            });

            document.getElementById('wishlistTotal').textContent = `₹${totalAmount}`;
        }

        // Function to update quantity
        function updateQuantity(index, change) {
            wishlistItems[index].quantity += change;
            if (wishlistItems[index].quantity <= 0) {
                removeItem(index);
            } else {
                document.getElementById(`quantity_${index}`).textContent = wishlistItems[index].quantity;
                saveWishlist();
                renderWishlist();
            }
        }

        // Function to remove item from wishlist
        function removeItem(index) {
            wishlistItems.splice(index, 1);
            saveWishlist();
            renderWishlist();
        }

        // Function to add item to order
        function addToOrder(index) {
            const item = wishlistItems[index];
            const existingOrderItemIndex = orderItems.findIndex(orderItem => orderItem.name === item.name);

            if (existingOrderItemIndex >= 0) {
                orderItems[existingOrderItemIndex].quantity += item.quantity;
            } else {
                orderItems.push({ ...item });
            }

            saveOrderItems();
            removeItem(index);

            alert(`Added to order:\nDish: ${item.name}\nPrice: ₹${item.price}\nQuantity: ${item.quantity}`);
        }

        // Initial render of wishlist
        renderWishlist();
    </script>
</body>
</html>
